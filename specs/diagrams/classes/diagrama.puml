@startuml classes

!define LIGHTYELLOW #FFFACD
!define LIGHTBLUE #E6F3FF
!define LIGHTGREEN #E6FFE6
!define LIGHTPINK #FFE6F0
!define LIGHTGRAY #F0F0F0

abstract Usuario {
  - nome: String
  - email: String
  - senha: String
  - foto: byte[]
  - status: Boolean
  + encerrar_sessao(): Boolean
  # autenticar(email: String, senha: String): Boolean
  + buscar_tentativas_acesso_falhas(): List<TentativaAcesso>
  + editar(usuario: Usuario): Boolean
  + reportar_erro(erro: ErroReportado): Boolean
}

abstract Gestor extends Usuario {
  + visualizar_status_sistema(): StatusSistema
  + visualizar_status_modulo(modulo: String): StatusModulo
}

abstract Associado extends Usuario {}

class Gerente extends Gestor {
  + criar_associado(associado: Associado): Boolean
  + editar_associado(associado: Associado): Boolean
  + apagar_associado(associado: Associado): Boolean
  + buscar_associado(nome: String): Associado
  + listar_associados(tipo: String): List<Associado>
  + desativar_associado(associado: Associado): Boolean
  + ativar_associado(associado: Associado): Boolean
}

class Cliente extends Associado {
  - tipo: String
  - razao_social: String
  - cpf: String
  - cnpj: String
  - cnpj_escritorio: String
}

class Contador extends Associado {}

class Administrador extends Gestor {
  + encerrar_sessao(usuario: Usuario): Boolean
  + liberar_acesso_usuario(usuario: Usuario): Boolean 
  + criar_politica_senha(politica: PoliticaSenha): Boolean
  + editar_politica_senha(politica: PoliticaSenha): Boolean
  + apagar_politica_senha(politica: PoliticaSenha): Boolean
  + buscar_politica_senha(nome: String): Boolean
  + listar_politica_senha(): List<PoliticaSenha>
  + criar_usuario(usuario: Usuario): Boolean
  + editar_usuario(usuario: Usuario): Boolean
  + apagar_usuario(usuario: Usuario): Boolean
  + buscar_usuario(nome: String): Usuario
  + listar_usuarios(tipo: String): List<Usuario>
  + desativar_usuario(usuario: Usuario): Boolean
  + ativar_usuario(usuario: Usuario): Boolean
  + criar_rotina(rotina: RotinaBackup): Boolean
  + editar_rotina(rotina: RotinaBackup): Boolean
  + apagar_rotina(rotina: RotinaBackup): Boolean
  + buscar_rotina(nome: String): RotinaBackup
  + listar_rotinas(): List<RotinaBackup>
  + listar_logs(): List<Log>
  + editar_politica_log(politica: PoliticaLog): Boolean
}

class Tecnico extends Usuario {
  + listar_usuarios(): List<Usuario>
}

class Cliente {}


class PoliticaSenha {
  - nome: String
  - tempo_expiracao: Integer
  - tempo_aviso_previo_expiracao: Integer
  - usuarios_afetados: List<Usuario>
  + notificar_expiracao(): void
}

class TentativaAcesso {
  - datahora: Timestamp
  - dispositivo: String
}

class RotinaBackup {
  - nome: String
  - intervalo: Integer
  - destino: String
  - criptografia: String
  - compactacao: String
  - dados: List<String>
}

' so existe uma
class PoliticaLog {
  - tempo_armazenamento: Integer
  - detalhamento: String
  - categoria: String
}

class Log {
  - datahora: Timestamp
  - origem: String
  - nivel: String
  - mensagem: String
  - mensagem_detalhada: String
  - stack_trace: String
}

class ErroReportado {
  - descricao: String
  - arquivos: List<byte[]>
}

class StatusSistema {
  - datahora_atualizacao: Timestamp
  - tempo_medio_resposta: Integer
  - usuarios_ativos: List<Usuario>
  - cpu: Double
  - ram: Double
  - disco: Double
  - rede: Double
  - modulos_ativos: List<String>
}

class StatusModulo {
  - modulo: String
  - cpu: Double
  - ram: Double
  - disco: Double
  - uptime: Integer
  - latencia_media: Double
  - alertas_recentes: List<String>
}

Administrador ..> Usuario : "mantém"
Administrador ..> PoliticaLog : "configura"
Administrador ..> PoliticaSenha : "mantém"
Administrador ..> RotinaBackup : "mantém"
Administrador ..> Log : "visualiza"

Gerente ..> Associado : "mantém"

Gestor ..> StatusModulo : "visualiza"
Gestor ..> StatusSistema : "visualiza"

Usuario ..> TentativaAcesso : "visualiza"
Usuario ..> ErroReportado : "reporta"


package "Domínio Principal" {
    
    class Simulacao LIGHTYELLOW {
        - nome: String
        - descricao: String
        - dataSimulacao: DateTime
        - usuarioResponsavel: UUID
        - receitaBruta: Decimal
        - rbt12: Decimal
        - folhaPagamento: Decimal
        - custos: Decimal
        - despesas: Decimal
        --
        + criar(): Simulacao
        + salvar(): void
        + carregar(id ??): Simulacao
        + exportar(formato: String): File
    }
    
    class Empresa LIGHTYELLOW {
        - cnpj: String
        - razaoSocial: String
        - municipio: String
        - uf: String
        - dataAbertura: Date
        --
        + validarCNPJ(): Boolean
    }
    
    class CNAE LIGHTYELLOW {
        - codigo: String
        - descricao: String
        - setorEconomico: String
        --
        + identificarAnexo(): AnexoSimplesNacional
        + mapearParaAnexo(): String
        + derivarSetor(): String
    }
    
    class ResultadoSimulacao LIGHTYELLOW {
        - cargaTributaria: Decimal
        - aliquotaEfetiva: Decimal
        - tributos: List<Tributo>
        - dataCalculo: DateTime
        - elegivel: Boolean
        --
        + exportar(formato: String): File
        + getTotalTributos(): Decimal
    }
}

package "Regimes Tributários" {
    
    abstract class RegimeTributario <<Abstract>> LIGHTBLUE {
        # nomeRegime: String
        # elegivel: Boolean
        --
        + {abstract} calcular(): ResultadoSimulacao
        + validarElegibilidade(): Boolean
        + calcularPIS(receita: Decimal): Decimal
        + calcularCOFINS(receita: Decimal): Decimal
    }
    
    class SimplesNacional LIGHTGREEN {
        - fatorR: Decimal
        - anexo: AnexoSimplesNacional
        - faixa: FaixaReceita
        --
        + calcular(): ResultadoSimulacao
        + calcularFatorR(): Decimal
        + determinarFaixa(): FaixaReceita
        + calcularAliquotaEfetiva(): Decimal
        + calcularDAS(): Decimal
        + segregarTributos(): List<Tributo>
    }
    
    class LucroPresumido LIGHTGREEN {
        - aliquotaPresuncao: Decimal
        --
        + calcular(): ResultadoSimulacao
        + calcularBasePresumida(): Decimal
        + calcularIRPJ(): Decimal
        + calcularCSLL(): Decimal
    }
    
    class LucroReal LIGHTGREEN {
        - lucroLiquido: Decimal
        - adicoes: Decimal
        - exclusoes: Decimal
        - prejuizos: Decimal
        --
        + calcular(): ResultadoSimulacao
        + apurarLucroLiquido(): Decimal
        + ajustarLucro(): Decimal
        + compensarPrejuizos(): Decimal
        + calcularCreditos(): Decimal
    }
    
    RegimeTributario <|-- SimplesNacional
    RegimeTributario <|-- LucroPresumido
    RegimeTributario <|-- LucroReal
}

package "Tabelas e Configurações" {
    
    class AnexoSimplesNacional LIGHTBLUE {
        - tipo: String
        - descricao: String
        - faixas: List<FaixaReceita>
        - percentualReparticao: Map<String, Decimal>
        --
        + obterFaixa(rbt12: Decimal): FaixaReceita
    }
    
    class FaixaReceita LIGHTBLUE {
        - numero: Integer
        - limiteInferior: Decimal
        - limiteSuperior: Decimal
        - aliquotaNominal: Decimal
        - parcelaADeduzir: Decimal
        --
        + contemReceita(rbt12: Decimal): Boolean
        + obterAliquotas(): Map<String, Decimal>
    }
}

package "Tributos" {
    
    class Tributo LIGHTPINK {
        - nome: String
        - baseCalculo: Decimal
        - aliquota: Decimal
        - valorFinal: Decimal
        --
        + detalhar(): DetalheTributo
        + calcular(): Decimal
    }
}

package "Comparação e Histórico" {
    
    class ComparacaoRegimes LIGHTBLUE {
        - dataComparacao: DateTime
        - simulacoes: List<Simulacao>
        - regimeMaisVantajoso: String
        --
        + comparar(): ResultadoComparacao
        + identificarMelhorRegime(): RegimeTributario
        + calcularEconomia(): Map<String, Decimal>
    }
    
    class HistoricoSimulacao LIGHTPINK {
        - versao: Integer
        - dataVersao: DateTime
        - valoresOriginais: Map<String, Object>
        - valoresNovos: Map<String, Object>
        --
        + criarVersao(): HistoricoSimulacao
    }
}

package "Validação" {
    
    class ValidadorDados <<Service>> LIGHTGRAY {
        --
        + validar(dados, regime): ValidationResult
        + validarObrigatorios(): List<ErroValidacao>
        + validarTipos(): List<ErroValidacao>
        + validarCNAE(): ValidationResult
        + verificarLimites(): ValidationResult
    }
    
    class ErroValidacao <<ValueObject>> LIGHTGRAY {
        - campoInvalido: String
        - mensagemErro: String
        - tipoErro: String
        --
        + getDescricao(): String
    }
}

' ===== RELACIONAMENTOS PRINCIPAIS =====

Simulacao "1" *-- "1" Empresa : possui >
Simulacao "1" *-- "1" RegimeTributario : simula >
Simulacao "1" --> "1" ResultadoSimulacao : gera >

Empresa "1" --> "1" CNAE : possui >

SimplesNacional "1" --> "1" AnexoSimplesNacional : utiliza >
SimplesNacional "1" --> "1" FaixaReceita : aplica >
AnexoSimplesNacional "1" *-- "6" FaixaReceita : possui >

RegimeTributario "1" --> "1..*" Tributo : calcula >
ResultadoSimulacao "1" *-- "1..*" Tributo : contém >

ComparacaoRegimes "1" *-- "2..3" Simulacao : compara >
HistoricoSimulacao "1" --> "1" Simulacao : versiona >

Simulacao ..> ValidadorDados : valida >
ValidadorDados "1" --> "0..*" ErroValidacao : retorna >


@enduml
