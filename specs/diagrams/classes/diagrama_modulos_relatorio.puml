@startuml
skinparam classAttributeIconSize 0
skinparam monochrome true

title Diagrama de Classes - Módulo de Relatórios

note as N1
  RF-REL-001: Consultar histórico de simulações
  RF-REL-002: Visualizar comparações entre regimes
  RF-REL-003: Gerar relatórios personalizados
  RF-REL-004: Exportar resultados
end note

class Contador {
    - nome: String
    - email: String
}

class Simulacao {
    - nome: String
    - descricao: String
    - dataSimulacao: DateTime
    - versaoTabelas: String
    - desatualizada: Boolean
    - cargaTributariaTotal: Decimal
    - regime: String
    --
    + salvar(): void
    + exportar(formato: String): File
    + marcarDesatualizada(): void
}

class HistoricoSimulacao {
    - versao: Integer
    - dataVersao: DateTime
    - dadosAnteriores: JSON
    - dadosNovos: JSON
    --
    + salvar(): void
    + listar(filtros: Map<String, Object>): List<Simulacao>
}

class Relatorio {
    - logoPersonalizada: byte[]
    - observacoes: String
    - metricas: List<String>
    - graficos: List<String>
    --
    + comparar(idsSimulacoes: List<UUID>): DadosComparacao
    + gerarPdf(opcoes: Map<String, Object>): File
    + enviarEmail(destinatario: String, opcoes: Map<String, Object>): Boolean
}

class DadosComparacao {
    - simulacoes: List<Simulacao>
    - economiaPercentual: Map<String, Decimal>
    - melhorRegime: String
    - graficosComparativos: List<Grafico>
    --
    + calcularEconomia(): Map<String, Decimal>
}

class Grafico {
    - tipo: String
    - titulo: String
    - dados: JSON
    --
    + renderizar(): byte[]
}

class ComparadorRegimes {
    --
    + comparar(dados: DadosFinanceiros): List<ResultadoCalculo>
    + identificarMelhorRegime(): String
}

' Relacionamentos
Contador ..> Relatorio : "gera relatórios"
Relatorio ..> Simulacao : "consulta"
Relatorio ..> HistoricoSimulacao : "acessa"
Relatorio ..> ComparadorRegimes : "usa"
Relatorio ..> DadosComparacao : "gera"
DadosComparacao "1" *-- "2..3" Simulacao : "compara"
DadosComparacao "1" *-- "1..*" Grafico : "contém"
Simulacao "1" --> "0..*" HistoricoSimulacao : "possui"

note right of Relatorio
  Responsável por:
  - Comparar múltiplas simulações
  - Gerar PDF personalizado
  - Enviar relatórios por email
  - Criar visualizações gráficas
end note

note right of HistoricoSimulacao
  Armazena versões das simulações
  e permite consulta com filtros:
  - Cliente
  - Período
  - Regime tributário
end note

@enduml